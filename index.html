<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¬Ø¯ÙˆÙ„ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø±Ù…Ø¶Ø§Ù† - Ø¬Ø§Ù…Ø¹ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø±Ø¨ÙŠØ¹ Ø¨Ù† Ø­Ø¨ÙŠØ¨</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
:root{
  --bg:#f0f4f2; --card:#ffffff; --accent:#1e8b63; --gold:#d4af37;
  --friday:#cfe3d6; --header-col:#49876d; --first-col:#49876d;
}
html, body{height:100%; margin:0; font-family:'Amiri', serif; background:var(--bg); color:#000;}
.container{ width:95%; max-width:1000px; margin:20px auto; padding:10px; }
.card{ background:var(--card); border-radius:14px; padding:1.5rem; border:4px solid var(--gold); }
.card-header { display:flex; justify-content:space-between; align-items:center; }

#saveBtn, #printBtn {
  padding:0.5rem 1rem; border-radius:12px; cursor:pointer; 
  font-weight:bold; color:#fff; font-size:1rem; border:none; margin:0.2rem;
}
#saveBtn { background: var(--gold); }
#printBtn { background: var(--accent); }

#saveMessage { color: green; font-weight: bold; display:none; margin-left:8px; }

.table-wrapper{ overflow-x:auto; }
table{ width:100%; border-collapse: collapse; background:#fff; border-radius:12px; }
thead th{ background:var(--header-col); color:#fff; padding:0.8rem; border:1px solid #ccc; }
tbody td{ padding:0.6rem; text-align:center; border:1px solid #ccc; }
tbody tr:nth-child(odd){ background:#f9f9f9; }
tbody tr.friday{ background-color:var(--friday) !important; }
tbody td:first-child{ background:var(--first-col); color:#fff; font-weight:700; }
</style>
</head>

<body>
<div class="container">
  <div class="card">
    
    <div class="card-header">
      <div>
        <button id="saveBtn">ğŸ’¾ Ø­ÙØ¸</button>
        <span id="saveMessage">ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…</span>
      </div>
      <button id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>

    <h1>Ø¬Ø¯ÙˆÙ„ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø±Ù…Ø¶Ø§Ù† 1447 Ù‡Ù€ - Ø¬Ø§Ù…Ø¹ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø±Ø¨ÙŠØ¹ Ø¨Ù† Ø­Ø¨ÙŠØ¨</h1>

    <div class="table-wrapper">
      <table id="mainTable">
        <thead>
          <tr>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„ÙˆÙ‚Øª</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±</th>
            <th>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>
</div>

<script>
// ===============================
//   GitHub API â€“ ØªØ­Ø¯ÙŠØ« data.json
// ===============================
async function updateGitHubFile(newData) {

  // -----------------------------
  // Ø§Ø·Ù„Ø¨ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
  // -----------------------------
  const token = localStorage.getItem("github_token") || prompt("Ø£Ø¯Ø®Ù„ GitHub Token:");
  localStorage.setItem("github_token", token);

  // -----------------------------
  // ğŸ”§ Ø¹Ø¯Ù‘Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… â†“â†“â†“
  // -----------------------------
  const username = "SNasser026";     // â† Ø¶Ø¹ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… GitHub
  const repo     = "ramadan1447";    // â† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
  const branch   = "main";           // â† ÙØ±Ø¹Ùƒ
  const path     = "data.json";      // â† Ø«Ø§Ø¨Øª

  // 1) Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA Ù„Ù„Ù…Ù„Ù
  const fileRes = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${path}?ref=${branch}`);

  if (!fileRes.ok) {
    alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ data.json ÙÙŠ GitHub âŒ");
    return;
  }

  const fileData = await fileRes.json();
  const sha = fileData.sha;

  // 2) ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(newData, null, 2))));

  // 3) Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«
  const updateRes = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${path}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${token}`
    },
    body: JSON.stringify({
      message: "Update Ramadan schedule",
      content: encoded,
      sha: sha,
      branch: branch
    })
  });

  if (updateRes.ok) {
    document.getElementById("saveMessage").style.display = "inline";
    setTimeout(() => { document.getElementById("saveMessage").style.display = "none"; }, 2000);
  } else {
    alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸ Ø¥Ù„Ù‰ GitHub âŒ");
  }
}


// ===============================
//      Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
// ===============================
document.addEventListener("DOMContentLoaded", () => {
  const tbody = document.querySelector("#mainTable tbody");
  const TOTAL_DAYS = 30;
  const START_DATE = new Date(2026, 1, 18);
  const weekdays = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];

  function createRows(data){
    tbody.innerHTML = "";
    data.forEach(row => {
      const tr = document.createElement("tr");
      if (row.weekday === "Ø§Ù„Ø¬Ù…Ø¹Ø©") tr.classList.add("friday");

      tr.innerHTML = `
        <td contenteditable="true">${row.date}</td>
        <td>
          <select>
            ${row.options.map(o => `<option ${o === row.time ? "selected" : ""}>${o}</option>`).join("")}
          </select>
        </td>
        <td contenteditable="true">${row.name}</td>
        <td contenteditable="true">${row.phone}</td>
      `;

      tbody.appendChild(tr);
    });
  }

  async function fetchData(){
    try {
      const res = await fetch("data.json");
      const data = await res.json();
      createRows(data);
    } catch {
      let data = [];
      for (let i = 1; i <= TOTAL_DAYS; i++) {
        const d = new Date(START_DATE);
        d.setDate(START_DATE.getDate() + (i - 1));
        const w = weekdays[d.getDay()];

        const options = (w === "Ø§Ù„Ø¬Ù…Ø¹Ø©")
          ? ["Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ±","Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ù…ØºØ±Ø¨","Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡"]
          : ["Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø±","Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ±","Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ù…ØºØ±Ø¨","Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡"];

        data.push({
          date: `${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()} - ${w} - Ø±Ù…Ø¶Ø§Ù† ${i}`,
          weekday: w,
          time: options[0],
          options: options,
          name: "",
          phone: ""
        });
      }
      createRows(data);
    }
  }

  fetchData();

  // Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
  document.getElementById("printBtn").addEventListener("click", () => window.print());

  // Ø²Ø± Ø§Ù„Ø­ÙØ¸ (GitHub API)
  document.getElementById("saveBtn").addEventListener("click", async () => {
    const rows = [];
    document.querySelectorAll("#mainTable tbody tr").forEach(tr => {
      const tds = tr.querySelectorAll("td");
      const select = tr.querySelector("select");

      rows.push({
        date: tds[0].textContent.trim(),
        weekday: tr.classList.contains("friday") ? "Ø§Ù„Ø¬Ù…Ø¹Ø©" : "",
        time: select.value,
        options: Array.from(select.options).map(o => o.textContent),
        name: tds[2].textContent.trim(),
        phone: tds[3].textContent.trim()
      });
    });

    await updateGitHubFile(rows);
  });
});
</script>

</body>
</html>
